<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teacher Dashboard</title>
  <link rel="stylesheet" href="/css/teacher/dashboard.css" />
</head>

<body>

  <%- include("../layouts/navbarYassine.ejs") %>

    <div class="content">
      <div class="profile">
        <img src="/images/profile.jpg" alt="" />
        <div>
          <div class="info">
            <h1>
              <%= user.firstName %>
                <%= user.lastName %>
            </h1>
            <p>
              <%= user.email %>
            </p>
          </div>
          <div class="line"></div>
          <div class="stats">
            <div class="state">
              <div class="icons">
                <svg class="svg-icon" viewBox="0 0 20 20" width="24" height="24" fill="currentColor">
                  <path
                    d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z">
                  </path>
                </svg>
              </div>
              <div class="items">
                <h1>27</h1>
                <p>Students</p>
              </div>
            </div>

            <div class="state">
              <div class="icons">
                <svg class="svg-icon" viewBox="0 0 20 20" width="24" height="24" fill="currentColor">
                  <path
                    d="M17.927,5.828h-4.41l-1.929-1.961c-0.078-0.079-0.186-0.125-0.297-0.125H4.159c-0.229,0-0.417,0.188-0.417,0.417v1.669H2.073c-0.229,0-0.417,0.188-0.417,0.417v9.596c0,0.229,0.188,0.417,0.417,0.417h15.854c0.229,0,0.417-0.188,0.417-0.417V6.245C18.344,6.016,18.156,5.828,17.927,5.828 M4.577,4.577h6.539l1.231,1.251h-7.77V4.577z M17.51,15.424H2.491V6.663H17.51V15.424z">
                  </path>
                </svg>
              </div>
              <div class="items">
                <p>Math</p>
              </div>
            </div>


          </div>
        </div>
      </div>
      <div class="title-list">
        <h1 class="list-quiz">Quizzes List</h1>
        <a href="/teacher/quiz" class="create-btn">Create Quiz</a>

      </div>

      <div class="quizzes">
        <% if (quizzes && quizzes.length> 0) { %>
          <% quizzes.forEach(quiz=> { %>
            <a href='/teacher/editQuiz/<%= quiz.quiz_id %>' class="quiz-card"
              style="background-image: url('<%= quiz.question_image %>'); background-position: center; background-size: cover;">

              <div class="quiz-num">
                <div class="teacher-name" style="
                    background-color: rgba(12, 30, 192, 0.5);
                    backdrop-filter: blur(20px);
                    -webkit-backdrop-filter: blur(20px);
                  ">
                  <p>
                    <%= quiz.title %>
                  </p>
                  <button class="delete-btn" onclick="onDeleteQuiz('<%= quiz.quiz_id %>')">Delete</button>

                </div>
              </div>
            </a>
            <% }); %>
              <% } else { %>
                <p>No quizzes available.</p>
                <% } %>
      </div>
    </div>
</body>
<script>
  console.log('script quiz')

  async function onDeleteQuiz(id) {
    console.log(id)
    if (confirm('Are you sure you want to delete this quiz?')) {
      try {
        const url = `http://localhost:3000/quiz/${id}`;
        console.log('Sending DELETE request to:', url);

        const response = await fetch(url, {
          method: 'DELETE',
        });

        console.log('Response status:', response.status);

        if (response.ok) {
          alert('Quiz deleted successfully');
          location.reload(); // Refresh the page
        } else {
          const errorText = await response.text();
          console.error('Error response:', errorText);
          alert(`Failed to delete quiz. Server responded with status ${response.status}`);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while deleting the quiz');
      }
    }
  }
</script>

</html>