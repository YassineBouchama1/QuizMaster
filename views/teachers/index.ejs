<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teacher Dashboard</title>
  <link rel="stylesheet" href="/css/student.css" />
  <link rel="stylesheet" href="/css/teacher/dashboard.css" />
</head>

<body>
  <h1 class="logo">JsSmartExam</h1>

  <div class="content">
    <div class="profile">
      <img src="/images/profile.jpg" alt="" />
      <div>
        <div class="info">
          <h1>
            <%= user.firstName %>
              <%= user.lastName %>
          </h1>
          <p>
            <%= user.email %>
          </p>
        </div>
        <div class="line"></div>
        <div class="stats">
          

          

          <div class="state">
            <a href="/quiz/create">
              <div class="icons">+</div>
            </a>
            <div class="items">
              <h1></h1>
              <p>Add Quiz</p>
            </div>
          </div>

          <div class="state">
            <a href="#" id="openModal">
              <div class="icons">+</div>
            </a>
            <div class="items">
              <h1></h1>
              <p>Add level</p>
            </div>
          </div>

          <div id="myModal" class="modal">
            <div class="modal-content">
              <span class="close">&times;</span>
              <p>Ajouter un nouveau niveau ici.</p>
          
              <form action="/levels" method="POST">
                <label for="description">Description :</label>
                <input type="text" id="description" name="description" required>
          
                <label for="min">Min :</label>
                <input type="number" id="min" name="min" required>
          
                <label for="max">Max :</label>
                <input type="number" id="max" name="max" required>
          
                <button type="submit">Ajouter</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h1>Quizzes List</h1>

    <div class="quizzes">
      <% if (quizzes && quizzes.length> 0) { %>
        <% quizzes.forEach(quiz=> { %>
          <div class="quiz-card"
            style="background-image: url('<%= quiz.question_image %>'); background-position: center; background-size: cover;">

            <div class="quiz-num">
              <div class="teacher-name" style="
                    background-color: rgba(12, 30, 192, 0.5);
                    backdrop-filter: blur(20px);
                    -webkit-backdrop-filter: blur(20px);
                  ">
                <p>
                  <%= quiz.title %>
                </p>
                <button class="delete-btn" onclick="onDeleteQuiz('<%= quiz.quiz_id %>')">Delete</button>

              </div>
            </div>
          </div>
          <% }); %>
            <% } else { %>
              <p>No quizzes available.</p>
              <% } %>
    </div>
  </div>
</body>
<script>
document.addEventListener('DOMContentLoaded', () => {
  var modal = document.getElementById("myModal");
  var btn = document.getElementById("openModal");
  var span = document.getElementsByClassName("close")[0];

  function openModal() {
    modal.style.display = "flex";
    setTimeout(() => {
      modal.querySelector('.modal-content').style.opacity = "1";
    }, 10);
  }

  function closeModal() {
    modal.querySelector('.modal-content').style.opacity = "0";
    setTimeout(() => {
      modal.style.display = "none";
    }, 300);
  }

  btn.onclick = openModal;
  span.onclick = closeModal;

  window.onclick = function(event) {
    if (event.target == modal) {
      closeModal();
    }
  }

  modal.querySelector('.modal-content').style.opacity = "0";
});

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

  console.log('script quiz')

  async function onDeleteQuiz(id) {
    console.log(id)
    if (confirm('Are you sure you want to delete this quiz?')) {
      try {
        const url = `http://localhost:3000/quiz/${id}`;
        console.log('Sending DELETE request to:', url);

        const response = await fetch(url, {
          method: 'DELETE',
        });

        console.log('Response status:', response.status);

        if (response.ok) {
          alert('Quiz deleted successfully');
          location.reload(); // Refresh the page
        } else {
          const errorText = await response.text();
          console.error('Error response:', errorText);
          alert(`Failed to delete quiz. Server responded with status ${response.status}`);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while deleting the quiz');
      }
    }
  }



</script>

</html>